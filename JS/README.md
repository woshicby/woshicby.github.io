# JS 目录说明文档

本目录包含网站的JavaScript文件，实现各种交互功能和页面逻辑。

## 文件结构

```
JS/
├── navigation.js      # 响应式导航栏交互逻辑
├── pace-calculator.js # 配速计算器核心功能
├── touken-forge.js    # 锻刀模拟器游戏逻辑
├── theme-toggle.js    # 主题切换功能（新增）
└── bilibili-api.js    # B站API集成（新增）
```

## 文件说明

### navigation.js

**响应式导航栏交互逻辑**，提供以下功能：
- 移动端汉堡菜单切换效果
- 导航菜单展开/收起动画
- 点击导航链接后自动收起菜单
- 窗口大小变化时的响应式调整
- 与主题切换系统兼容，动态调整导航栏样式

主要实现原理：
- 监听汉堡菜单按钮的点击事件
- 通过添加/移除CSS类来控制菜单显示状态
- 实现汉堡菜单按钮到X形状的动画转换
- 监听窗口大小变化，在大屏幕时自动展开导航菜单
- 监听主题变化事件，调整导航栏样式以适应不同主题

### pace-calculator.js

**配速计算器核心功能**，提供以下功能：
- 距离和时间输入验证
- 自动计算配速结果（分钟/公里）
- 实时结果更新
- 格式化时间显示
- 与B站API集成，支持相关内容展示
- 返回按钮功能与tools-common.css样式集成

主要实现原理：
- 监听表单输入事件
- 进行数据验证和单位转换
- 执行配速计算逻辑
- 更新页面上的计算结果显示
- 调用B站API获取相关内容数据
- 响应主题变化，调整界面颜色显示

### touken-forge.js

**刀剑乱舞锻刀模拟器游戏逻辑**，提供以下功能：
- 材料选择和数量设置
- 锻刀动画和效果
- 结果随机生成和展示
- 历史记录管理
- 本地存储用户数据
- 游戏化界面控制

主要实现原理：
- 材料投入逻辑和验证
- 基于投入材料的概率计算
- 结果展示和UI交互
- 本地存储历史记录
- 与主题切换系统集成，适配不同主题下的颜色方案

### theme-toggle.js

**主题切换功能**，提供以下功能：
- 深色/浅色主题切换
- 主题状态的本地存储和恢复
- 主题切换按钮的交互逻辑
- 监听系统主题偏好变化
- 平滑的主题过渡动画

主要实现原理：
- 通过CSS变量管理主题颜色
- 监听主题切换按钮点击事件
- 使用localStorage保存用户主题偏好
- 监听系统主题变化（prefers-color-scheme）
- 实现主题切换的平滑过渡效果

### bilibili-api.js

**B站API集成**，提供以下功能：
- 视频信息获取和解析
- 弹幕获取和显示（可选）
- 评论区数据获取（可选）
- API请求封装和错误处理
- 缓存机制优化性能

主要实现原理：
- 封装fetch请求处理API调用
- 实现请求错误处理和重试机制
- 使用localStorage进行数据缓存
- 提供简化的API接口供其他模块调用

## 开发规范

### 代码风格

- 采用函数式编程风格
- 使用ES6+语法特性
- 变量和函数命名遵循驼峰命名法（camelCase）
- 常量使用全大写和下划线（UPPER_SNAKE_CASE）

### 文件组织

- 每个JS文件对应一个主要功能模块
- 相关功能封装在独立函数中
- 使用文档注释说明函数用途和参数

### 最佳实践

- 使用事件委托处理动态生成的元素
- 避免全局变量污染，使用IIFE或模块模式
- 适当使用本地存储保存用户数据
- 确保错误处理和异常捕获
- 优化性能，避免不必要的DOM操作
- 确保主题兼容性，使用CSS变量而非硬编码颜色
- 监听主题变化事件，动态调整UI组件样式
- API调用时实现错误处理和超时控制

## 开发指南

1. **添加新功能**：
   - 分析功能需求并设计实现方案
   - 创建新的JS文件或在现有文件中添加功能
   - 编写测试确保功能正常工作
   - 在HTML文件中引入新的JS文件

2. **修改现有功能**：
   - 理解现有代码的结构和逻辑
   - 遵循现有的代码风格和命名规范
   - 进行适当的代码重构以提高可维护性
   - 测试确保修改不会影响现有功能

3. **性能优化**：
   - 减少DOM操作次数
   - 使用事件委托处理列表元素
   - 避免在循环中进行DOM操作
   - 合理使用缓存减少计算量

## 注意事项

- 所有JS文件应该在HTML文件末尾引入，或使用`defer`属性
- 确保JS代码兼容现代浏览器
- 避免使用已经废弃的API
- 定期检查和更新第三方库（如有）
- 所有页面必须引入navigation.js和theme-toggle.js以确保基础功能
- 主题相关操作必须通过theme-toggle.js提供的接口进行，避免直接修改样式
- API调用时注意请求频率限制，必要时实现请求缓存机制
- 确保响应式布局的交互逻辑在各种设备上都能正常工作
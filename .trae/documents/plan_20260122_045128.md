# 文明边界改进计划

## 改进目标
解决文明边界呈直线的问题，使边界更自然、更符合现实，增加游戏的真实感和趣味性。

## 实现方案

### 1. 改进影响力计算

#### 1.1 改用欧几里得距离
- 将曼哈顿距离替换为欧几里得距离，产生更自然的圆形影响力场
- 计算公式：`distance = Math.sqrt(Math.pow(x - civGridX, 2) + Math.pow(y - civGridY, 2))`

#### 1.2 添加地形阻碍效应
- 为不同地形添加影响力阻碍系数
- 实现基于地形的影响力衰减调整，而非简单的乘法系数
- 例如：山脉阻碍60%影响力，森林阻碍30%，平原无阻碍

#### 1.3 引入随机波动
- 为每个格子的影响力添加小范围随机波动
- 避免完美对称的影响力场，增加边界的不规则性

### 2. 动态文明中心

#### 2.1 实现文明中心动态更新
- 添加`calculateCivilizationCenter`方法，基于文明领土的重心计算新的文明中心
- 在每个演化周期更新文明中心位置
- 文明中心将随领土扩张自然移动

#### 2.2 中心计算方法
- 计算文明所有领土格子的平均坐标作为重心
- 考虑格子人口密度作为权重，人口密集区对中心影响更大

### 3. 局部影响力传播

#### 3.1 实现影响力扩散算法
- 添加`spreadInfluence`方法，实现相邻格子间的影响力扩散
- 基于格子间的影响力差异进行扩散
- 平滑影响力分布，形成更自然的边界

#### 3.2 扩散规则
- 影响力从高值格子向低值格子扩散
- 扩散速率受地形影响
- 扩散迭代多次，形成平滑过渡

### 4. 代码修改计划

#### 4.1 修改 Simulator.js
- 更新`calculateInfluence`方法，使用欧几里得距离和地形阻碍
- 添加`calculateCivilizationCenter`方法
- 在`evolve`方法中更新文明中心
- 添加`spreadInfluence`方法，实现影响力扩散

#### 4.2 修改 Civilization.js
- 添加计算文明领土重心的辅助方法

#### 4.3 修改 MapSystem.js
- 为地形添加影响力阻碍属性

## 预期效果
- 文明边界从直线变为更自然的曲线
- 边界过渡更平滑，减少尖锐边缘
- 文明扩张更符合自然规律
- 游戏地图更具真实感和视觉吸引力

## 技术要点
- 欧几里得距离计算
- 重心计算算法
- 影响力扩散算法
- 动态中心更新
- 地形影响建模

## 实施步骤
1. 首先修改影响力计算，改用欧几里得距离
2. 添加动态文明中心计算
3. 实现影响力扩散
4. 添加随机波动和地形阻碍
5. 测试并调整参数

这个改进方案将显著改善文明边界的视觉效果，使文明演化过程更加真实和有趣。